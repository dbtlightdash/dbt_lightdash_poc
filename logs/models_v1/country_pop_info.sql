SELECT 
country_code,
country_name,
COALESCE(MAX(area_sq_km),0)AS area_sq_km,
COALESCE(MAX(CAST(smoking_prevalence AS INT)),0) AS smoking_prevalence,
COALESCE(MAX(CAST(diabetes_prevalence AS INT)),0) AS diabetes_prevalence,
COALESCE(MAX(CAST(infant_mortality_rate AS INT)),0) AS infant_mortality_rate,
COALESCE(MAX(CAST(nurses_per_1000 AS INT)),0) AS nurses_per_1000,
COALESCE(MAX(CAST(physicians_per_1000 AS INT)),0) AS physicians_per_1000,
COALESCE(MAX(CAST(health_expenditure_usd AS INT)),0) AS health_expenditure_usd,
COALESCE(MAX(CAST(out_of_pocket_health_expenditure_usd AS INT)),0) AS OOP_health_spend_usd,
COALESCE(MAX(school_closing),0) AS school_closing,
COALESCE(MAX(workplace_closing),0) AS workplace_closing,
COALESCE(MAX(cancel_public_events),0) AS cancel_public_events,
COALESCE(MAX(restrictions_on_gatherings),0) AS restrictions_on_gatherings,
COALESCE(MAX(public_transport_closing),0) AS public_transport_closing,
COALESCE(MAX(stay_at_home_requirements),0) AS stay_at_home_requirements,
COALESCE(MAX(restrictions_on_internal_movement),0) AS restrictions_on_internal_movement,
COALESCE(MAX(international_travel_controls),0) AS international_travel_controls,
COALESCE(MAX(income_support),0) AS income_support,
COALESCE(MAX(debt_relief),0) AS debt_relief,
COALESCE(MAX(fiscal_measures),0) AS fiscal_measures,
COALESCE(MAX(international_support),0) AS international_support,
COALESCE(MAX(public_information_campaigns),0) AS public_information_campaigns,
COALESCE(MAX(testing_policy),0) AS testing_policy,
COALESCE(MAX(contact_tracing),0) AS contact_tracing,
COALESCE(MAX(emergency_investment_in_healthcare),0) AS emergency_investment_in_healthcare,
COALESCE(MAX(investment_in_vaccines),0) AS investment_in_vaccines,
COALESCE(MAX(facial_coverings),0) AS facial_coverings,
COALESCE(MAX(vaccination_policy),0) AS vaccination_policy,
COALESCE(AVG(CAST(stringency_index AS INT)),0) AS stringency_index,
COALESCE(MAX(CAST(average_temperature_celsius AS INT)),0) AS average_temperature_celsius,
COALESCE(MAX(CAST(minimum_temperature_celsius AS INT)),0) AS minimum_temperature_celsius,
COALESCE(MAX(CAST(maximum_temperature_celsius AS INT)),0) AS maximum_temperature_celsius,
COALESCE(MAX(CAST(rainfall_mm AS INT)),0) AS rainfall_mm,
COALESCE(MAX(CAST(snowfall_mm AS INT)),0) AS snowfall_mm,
COALESCE(AVG(CAST(dew_point AS INT)),0) AS dew_point,
COALESCE(MAX(CAST(relative_humidity AS INT)),0) AS relative_humidity,
COALESCE(AVG(CAST(population_largest_city AS INT)),0) AS population_largest_city,
COALESCE(AVG(CAST(population_clustered AS INT)),0) AS population_clustered,
COALESCE(AVG(CAST(area_rural_sq_km AS INT)),0) AS area_rural_sq_km,
COALESCE(AVG(CAST(area_urban_sq_km AS INT)),0) AS area_urban_sq_km,
COALESCE(AVG(CAST(mobility_retail_and_recreation AS INT)),0) AS mobility_retail_and_recreation,
COALESCE(AVG(CAST(mobility_grocery_and_pharmacy AS INT)),0) AS mobility_grocery_and_pharmacy,
COALESCE(AVG(CAST(mobility_parks AS INT)),0) AS mobility_parks,
COALESCE(AVG(CAST(mobility_transit_stations AS INT)),0) AS mobility_transit_stations,
COALESCE(AVG(CAST(mobility_workplaces AS INT)),0) AS mobility_workplaces,
COALESCE(AVG(CAST(mobility_residential AS INT)),0) AS mobility_residential,
COALESCE(AVG(CAST(hospital_beds_per_1000 AS INT)),0) AS hospital_beds_per_1000,
FROM {{ ref('stg_covid') }}
GROUP BY country_name,country_code
ORDER BY country_name